const timelineDataRaw = `
# Linha do Tempo da Hist√≥ria de A Igreja de Jesus Cristo dos Santos dos √öltimos Dias

## Per√≠odo: Vida Familiar e Primeiros Anos de Joseph Smith Jr.

### T√≠tulo: Nascimento e Inf√¢ncia de Joseph Smith Jr.

**Data:** 23 de dezembro de 1805

**Local:** Sharon, Vermont, EUA

**Detalhes:** Joseph Smith Jr. foi o quinto de onze filhos de Joseph Smith Sr. e Lucy Mack Smith. A fam√≠lia Smith era de fazendeiros de classe m√©dia, mas enfrentou dificuldades financeiras ap√≥s um investimento malsucedido de Joseph Smith Sr. em ginseng, o que os levou a perder a fazenda da fam√≠lia e a se tornarem arrendat√°rios e trabalhadores diaristas. A fam√≠lia mudou-se sete vezes nos quatorze anos seguintes. Apesar das dificuldades financeiras e das constantes mudan√ßas, Lucy Smith descreveu a inf√¢ncia de Joseph como 

"perfeitamente confort√°vel tanto para comida e vestu√°rio, quanto para o que √© necess√°rio para uma apar√™ncia respeit√°vel na sociedade." No inverno de 1812-1813, Joseph contraiu febre tifoide, que resultou em uma infec√ß√£o √≥ssea na perna. Ele foi submetido a uma cirurgia sem anestesia ou antiss√©ptico, e embora tenha se recuperado, usou muletas por v√°rios anos e mancava levemente pelo resto da vida. A fam√≠lia mudou-se para Palmyra, Nova York, em 1817, uma √°rea conhecida como "distrito queimado" devido aos intensos avivamentos religiosos da Segunda Grande Despertar.

**Contexto Hist√≥rico Mundial:**
* 1805: Batalha de Trafalgar (vit√≥ria naval brit√¢nica sobre a frota franco-espanhola), Batalha de Austerlitz (vit√≥ria decisiva de Napole√£o sobre as for√ßas austr√≠acas e russas).
* 1812: In√≠cio da Guerra de 1812 entre os Estados Unidos e o Reino Unido; Invas√£o de Napole√£o √† R√∫ssia.
* 1817: In√≠cio da Era do Bom Sentimento nos EUA (per√≠odo de relativa paz e prosperidade); James Monroe torna-se presidente dos EUA.

**Pontos Positivos:**
* Apesar das adversidades financeiras e de sa√∫de, a fam√≠lia Smith manteve um senso de uni√£o e resili√™ncia. A m√£e de Joseph, Lucy Mack Smith, desempenhou um papel fundamental na manuten√ß√£o do bem-estar familiar e na transmiss√£o de valores religiosos e morais.
* A experi√™ncia de Joseph com a febre tifoide e a cirurgia subsequente demonstrou sua not√°vel resist√™ncia f√≠sica e mental desde cedo.
* A descri√ß√£o de Joseph por sua m√£e como algu√©m "muito menos inclinado √† leitura de livros do que qualquer um dos outros filhos, mas muito mais dado √† medita√ß√£o e ao estudo profundo" sugere uma natureza contemplativa e imaginativa, que mais tarde seria atribu√≠da √† sua capacidade de receber revela√ß√µes.

**Pontos Negativos/Controversos:**
* A pobreza e a instabilidade financeira da fam√≠lia Smith s√£o frequentemente citadas por cr√≠ticos como um fator que poderia ter influenciado Joseph a buscar meios de subsist√™ncia n√£o convencionais, como a ca√ßa ao tesouro, antes de suas reivindica√ß√µes religiosas.
* A falta de educa√ß√£o formal de Joseph Smith √© um ponto de debate. Embora sua m√£e o descrevesse como imaginativo e capaz de contar hist√≥rias cativantes, a aus√™ncia de educa√ß√£o formal √© usada por alguns para questionar a origem de seus escritos religiosos.

**Fontes:**
* Wikipedia: [Early life of Joseph Smith](https://en.wikipedia.org/wiki/Early_life_of_Joseph_Smith)
* The Joseph Smith Papers: [How Much Do You Know about Joseph Smith's Childhood?](https://www.josephsmithpapers.org/articles/newsletter-01-2017-joseph-smith-childhood)
* Britannica: [Joseph Smith | Biography & Facts](https://www.britannica.com/biography/Joseph-Smith-American-religious-leader-1805-1844)




## Per√≠odo: Atividades de Joseph Smith Pr√©-Restaura√ß√£o

### T√≠tulo: A Primeira Vis√£o de Joseph Smith

**Data:** Primavera de 1820

**Local:** Bosque Sagrado, Manchester, Nova York, EUA

**Detalhes:** A Primeira Vis√£o √© um evento central na teologia dos Santos dos √öltimos Dias. Joseph Smith, ent√£o com cerca de 14 anos, buscando saber a qual igreja deveria se unir em meio a um per√≠odo de grande efervesc√™ncia religiosa (o Segundo Grande Despertar), retirou-se para um bosque pr√≥ximo √† sua casa para orar. Ele relatou ter sido atacado por um poder maligno que o paralisou e o impediu de falar. No momento de maior desespero, ele clamou a Deus e, em resposta, viu um pilar de luz que desceu sobre ele. Dentro da luz, ele viu duas Personagens, descritas em relatos posteriores como Deus, o Pai, e Jesus Cristo. Uma das Personagens (o Pai) apontou para a outra (o Filho) e disse: "Este √© Meu Filho Amado. Ouve-O!". Joseph perguntou qual igreja deveria se unir e foi instru√≠do a n√£o se unir a nenhuma delas, pois todas estavam em erro e suas cren√ßas eram uma abomina√ß√£o. Ele foi informado de que a plenitude do evangelho lhe seria revelada em um momento posterior.

Joseph Smith escreveu v√°rios relatos da vis√£o entre 1832 e 1842, dois dos quais foram publicados em sua vida. A consist√™ncia desses relatos √© um tema de debate, com varia√ß√µes que alguns consideram indicadores de mudan√ßas significativas na teologia de Smith, enquanto outros as veem como √™nfases diferentes em detalhes menores.

**Contexto Hist√≥rico Mundial:**
* 1820: Revolu√ß√£o Liberal do Porto em Portugal; Descoberta da Ant√°rtida por Fabian Gottlieb von Bellingshausen e Edward Bransfield; Publica√ß√£o de "Ivanhoe" de Walter Scott.

**Pontos Positivos:**
* Para os Santos dos √öltimos Dias, a Primeira Vis√£o √© a pedra angular da Restaura√ß√£o do evangelho de Jesus Cristo, confirmando a natureza corporal de Deus, o Pai, e Jesus Cristo, e a necessidade de uma restaura√ß√£o da Igreja.
* A experi√™ncia de Joseph Smith √© vista como um testemunho pessoal e direto da exist√™ncia de Deus e de Jesus Cristo, e da comunica√ß√£o divina com a humanidade nos tempos modernos.
* A vis√£o forneceu a Joseph Smith a dire√ß√£o para n√£o se unir a nenhuma das igrejas existentes, preparando o caminho para a organiza√ß√£o de uma nova igreja.

**Pontos Negativos/Controversos:**
* A exist√™ncia de m√∫ltiplos relatos da Primeira Vis√£o, com varia√ß√µes em detalhes como o n√∫mero de Personagens vistas e o prop√≥sito da ora√ß√£o de Joseph, √© frequentemente citada por cr√≠ticos como evid√™ncia de que a hist√≥ria evoluiu ao longo do tempo e n√£o foi um evento singular e consistente.
* A falta de men√ß√£o da Primeira Vis√£o em alguns dos primeiros escritos e serm√µes de Joseph Smith, e sua relativa obscuridade entre os primeiros membros da Igreja, √© outro ponto de controv√©rsia. A vis√£o s√≥ ganhou proemin√™ncia na teologia da Igreja de Jesus Cristo dos Santos dos √öltimos Dias no in√≠cio do s√©culo XX.
* Cr√≠ticos argumentam que a vis√£o pode ter sido influenciada pelo ambiente religioso da √©poca (o Segundo Grande Despertar) e pelas cren√ßas populares em vis√µes e revela√ß√µes.

**Fontes:**
* Wikipedia: [First Vision](https://en.wikipedia.org/wiki/First_Vision)
* The Joseph Smith Papers: [Accounts of the First Vision](https://www.josephsmithpapers.org/site/accounts-of-the-first-vision)
* The Church of Jesus Christ of Latter-day Saints: [First Vision](https://www.churchofjesuschrist.org/study/manual/gospel-topics/first-vision?lang=eng)
`;

    // --- FUN√á√ïES DE FORMATA√á√ÉO ---

    function convertToLinks(text) {
        if (!text) return '';
        let processedText = text;
        const markdownRegex = /\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g;
        processedText = processedText.replace(markdownRegex, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
        const plainUrlRegex = /(?<!href=")(https?:\/\/[^\s<]+)/g;
        processedText = processedText.replace(plainUrlRegex, (url) => {
            return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
        });
        return processedText;
    }

    function formatWorldContext(context) {
        if (!context) return '';
        const lines = context.split('\n').filter(line => line.trim());
        return lines.map(line => {
            const cleanLine = line.trim().replace(/^\*\s*/, '');
            const match = cleanLine.match(/^(\d{4}:.*?)(?=\s*\([^)]*\)|,|$)/);
            if (match) {
                const boldPart = match[1].trim();
                const restOfPart = cleanLine.substring(match[0].length);
                return `<p><strong>${boldPart}</strong>${restOfPart}</p>`;
            }
            return `<p>${cleanLine}</p>`;
        }).join('');
    }

    // --- L√ìGICA DE PARSING E RENDERIZA√á√ÉO ---

    function parseTimelineData(data) {
        const events = [];
        let currentPeriod = '', currentTitle = '', currentData = '', currentLocal = '', currentDetails = '', currentContext = '', currentPositive = '', currentNegative = '', currentSources = '';
        let inSection = null;

        const lines = data.split('\n');
        for (const line of lines) {
            if (line.startsWith('## Per√≠odo:')) {
                if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
                currentPeriod = line.replace('## Per√≠odo:', '').trim();
                currentTitle = ''; currentData = ''; currentLocal = ''; currentDetails = ''; currentContext = ''; currentPositive = ''; currentNegative = ''; currentSources = ''; inSection = null;
            } else if (line.startsWith('### T√≠tulo:')) {
                if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
                currentTitle = line.replace('### T√≠tulo:', '').trim();
                currentData = ''; currentLocal = ''; currentDetails = ''; currentContext = ''; currentPositive = ''; currentNegative = ''; currentSources = ''; inSection = null;
            } else if (line.startsWith('**Data:**')) { currentData = line.replace('**Data:**', '').trim(); inSection = null; }
            else if (line.startsWith('**Local:**')) { currentLocal = line.replace('**Local:**', '').trim(); inSection = null; }
            else if (line.startsWith('**Detalhes:**')) { currentDetails = line.replace('**Detalhes:**', '').trim(); inSection = 'details'; }
            else if (line.startsWith('**Contexto Hist√≥rico Mundial:**')) { currentContext = ''; inSection = 'context'; }
            else if (line.startsWith('**Pontos Positivos:**')) { currentPositive = ''; inSection = 'positive'; }
            else if (line.startsWith('**Pontos Negativos/Controversos:**')) { currentNegative = ''; inSection = 'negative'; }
            else if (line.startsWith('**Fontes:**')) { currentSources = ''; inSection = 'sources'; }
            else if (line.trim() !== '') {
                if (inSection === 'details') { currentDetails += '\n' + line; }
                else if (inSection === 'context') { currentContext += '\n' + line; }
                else if (inSection === 'positive') { currentPositive += '\n' + line; }
                else if (inSection === 'negative') { currentNegative += '\n' + line; }
                else if (inSection === 'sources') { currentSources += '\n' + line; }
            }
        }
        if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
        return events;
    }

    function extractYearFromDate(dateString) {
        const yearMatch = dateString.match(/\b(1[0-9]{3}|20[0-9]{2})\b/);
        return yearMatch ? yearMatch[0] : '????';
    }

    const timelineEvents = parseTimelineData(timelineDataRaw);
    const timelineContainer = document.getElementById('timeline-container');
    let itemIndex = 0;

    timelineEvents.forEach(event => {
        const item = document.createElement('div');
        item.classList.add('timeline-item');

        const badge = document.createElement('div');
        badge.classList.add('timeline-badge');
        badge.innerHTML = extractYearFromDate(event.data);
        item.appendChild(badge);

        const panel = document.createElement('div');
        panel.classList.add('timeline-panel');

        const heading = document.createElement('div');
        heading.classList.add('timeline-heading');
        heading.innerHTML = `<h3>${event.title}</h3><span class="timeline-date">${event.data} - ${event.local}</span>`;
        
        if (event.context) {
            const worldContext = document.createElement('div');
            worldContext.classList.add('world-context');
            // Removi a tag <hr> daqui conforme solicitado anteriormente
            worldContext.innerHTML = `<h5>üåç Contexto Hist√≥rico Mundial</h5><div>${formatWorldContext(event.context)}</div>`;
            heading.appendChild(worldContext);
        }
        
        panel.appendChild(heading);

        const body = document.createElement('div');
        body.classList.add('timeline-body');
        const summary = event.details.split('\n')[0] + '...';
        body.innerHTML = `<p>${convertToLinks(summary)}</p>`;
        panel.appendChild(body);

        const toggleButton = document.createElement('button');
        toggleButton.classList.add('toggle-details');
        toggleButton.textContent = 'Ver Detalhes';
        const detailsId = 'details-' + (itemIndex++);
        toggleButton.setAttribute('aria-expanded', 'false');
        toggleButton.setAttribute('aria-controls', detailsId);
        panel.appendChild(toggleButton);

        const fullDetails = document.createElement('div');
        fullDetails.classList.add('full-details');
        fullDetails.id = detailsId;
        
        // --- L√ìGICA DE MONTAGEM CORRIGIDA ---
        // Agora cada se√ß√£o √© criada e adicionada na ordem correta.

        // 1. Se√ß√£o de Detalhes
        const detailsDiv = document.createElement('div');
        detailsDiv.innerHTML = `<h4>Detalhes:</h4><p>${convertToLinks(event.details.replace(/\n/g, '<br>'))}</p>`;
        fullDetails.appendChild(detailsDiv);

        // 2. Se√ß√£o de Pontos Positivos
        if (event.positive) {
            const positiveSection = document.createElement('div');
            positiveSection.classList.add('positive-section');
            let content = '<ul>';
            event.positive.split('\n').filter(l => l.trim()).forEach(line => {
                content += `<li>${convertToLinks(line.replace(/^\*\s*/, ''))}</li>`;
            });
            content += '</ul>';
            positiveSection.innerHTML = `<h4>‚úÖ Pontos Positivos:</h4>${content}`;
            fullDetails.appendChild(positiveSection);
        }
        
        // 3. Se√ß√£o de Pontos Negativos/Controversos
        if (event.negative) {
            const negativeSection = document.createElement('div');
            negativeSection.classList.add('negative-section');
            let content = '<ul>';
            event.negative.split('\n').filter(l => l.trim()).forEach(line => {
                let processedLine = convertToLinks(line.replace(/^\*\s*/, ''));
                content += `<li class="critical-text">${processedLine}</li>`;
            });
            content += '</ul>';
            negativeSection.innerHTML = `<h4>‚ö†Ô∏è Pontos Negativos/Controversos:</h4>${content}`;
            fullDetails.appendChild(negativeSection);
        }
        
        // 4. Se√ß√£o de Fontes (Agora adicionada por √∫ltimo)
        if (event.sources) {
            const sourcesDiv = document.createElement('div');
            let sourcesContent = '<ul>';
            event.sources.split('\n').filter(l => l.trim()).forEach(line => {
                sourcesContent += `<li>${convertToLinks(line.replace(/^\*\s*/, ''))}</li>`;
            });
            sourcesContent += '</ul>';
            sourcesDiv.innerHTML = `<h4>üìö Fontes:</h4>${sourcesContent}`;
            fullDetails.appendChild(sourcesDiv);
        }
        
        panel.appendChild(fullDetails);

        toggleButton.addEventListener('click', () => {
            const isExpanded = fullDetails.style.display === 'block';
            fullDetails.style.display = isExpanded ? 'none' : 'block';
            toggleButton.setAttribute('aria-expanded', !isExpanded);
            toggleButton.textContent = isExpanded ? 'Ver Detalhes' : 'Ocultar Detalhes';
        });

        item.appendChild(panel);
        timelineContainer.appendChild(item);
    });