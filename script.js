const timelineDataRaw = `
# Linha do Tempo da História de A Igreja de Jesus Cristo dos Santos dos Últimos Dias

## Período: Vida Familiar e Primeiros Anos de Joseph Smith Jr.

### Título: Nascimento e Infância de Joseph Smith Jr.

**Data:** 23 de dezembro de 1805

**Local:** Sharon, Vermont, EUA

**Detalhes:** Joseph Smith Jr. foi o quinto de onze filhos de Joseph Smith Sr. e Lucy Mack Smith. A família Smith era de fazendeiros de classe média, mas enfrentou dificuldades financeiras após um investimento malsucedido de Joseph Smith Sr. em ginseng, o que os levou a perder a fazenda da família e a se tornarem arrendatários e trabalhadores diaristas. A família mudou-se sete vezes nos quatorze anos seguintes. Apesar das dificuldades financeiras e das constantes mudanças, Lucy Smith descreveu a infância de Joseph como 

"perfeitamente confortável tanto para comida e vestuário, quanto para o que é necessário para uma aparência respeitável na sociedade." No inverno de 1812-1813, Joseph contraiu febre tifoide, que resultou em uma infecção óssea na perna. Ele foi submetido a uma cirurgia sem anestesia ou antisséptico, e embora tenha se recuperado, usou muletas por vários anos e mancava levemente pelo resto da vida. A família mudou-se para Palmyra, Nova York, em 1817, uma área conhecida como "distrito queimado" devido aos intensos avivamentos religiosos da Segunda Grande Despertar.

**Contexto Histórico Mundial:**
* 1805: Batalha de Trafalgar (vitória naval britânica sobre a frota franco-espanhola), Batalha de Austerlitz (vitória decisiva de Napoleão sobre as forças austríacas e russas).
* 1812: Início da Guerra de 1812 entre os Estados Unidos e o Reino Unido; Invasão de Napoleão à Rússia.
* 1817: Início da Era do Bom Sentimento nos EUA (período de relativa paz e prosperidade); James Monroe torna-se presidente dos EUA.

**Pontos Positivos:**
* Apesar das adversidades financeiras e de saúde, a família Smith manteve um senso de união e resiliência. A mãe de Joseph, Lucy Mack Smith, desempenhou um papel fundamental na manutenção do bem-estar familiar e na transmissão de valores religiosos e morais.
* A experiência de Joseph com a febre tifoide e a cirurgia subsequente demonstrou sua notável resistência física e mental desde cedo.
* A descrição de Joseph por sua mãe como alguém "muito menos inclinado à leitura de livros do que qualquer um dos outros filhos, mas muito mais dado à meditação e ao estudo profundo" sugere uma natureza contemplativa e imaginativa, que mais tarde seria atribuída à sua capacidade de receber revelações.

**Pontos Negativos/Controversos:**
* A pobreza e a instabilidade financeira da família Smith são frequentemente citadas por críticos como um fator que poderia ter influenciado Joseph a buscar meios de subsistência não convencionais, como a caça ao tesouro, antes de suas reivindicações religiosas.
* A falta de educação formal de Joseph Smith é um ponto de debate. Embora sua mãe o descrevesse como imaginativo e capaz de contar histórias cativantes, a ausência de educação formal é usada por alguns para questionar a origem de seus escritos religiosos.

**Fontes:**
* Wikipedia: [Early life of Joseph Smith](https://en.wikipedia.org/wiki/Early_life_of_Joseph_Smith)
* The Joseph Smith Papers: [How Much Do You Know about Joseph Smith's Childhood?](https://www.josephsmithpapers.org/articles/newsletter-01-2017-joseph-smith-childhood)
* Britannica: [Joseph Smith | Biography & Facts](https://www.britannica.com/biography/Joseph-Smith-American-religious-leader-1805-1844)




## Período: Atividades de Joseph Smith Pré-Restauração

### Título: A Primeira Visão de Joseph Smith

**Data:** Primavera de 1820

**Local:** Bosque Sagrado, Manchester, Nova York, EUA

**Detalhes:** A Primeira Visão é um evento central na teologia dos Santos dos Últimos Dias. Joseph Smith, então com cerca de 14 anos, buscando saber a qual igreja deveria se unir em meio a um período de grande efervescência religiosa (o Segundo Grande Despertar), retirou-se para um bosque próximo à sua casa para orar. Ele relatou ter sido atacado por um poder maligno que o paralisou e o impediu de falar. No momento de maior desespero, ele clamou a Deus e, em resposta, viu um pilar de luz que desceu sobre ele. Dentro da luz, ele viu duas Personagens, descritas em relatos posteriores como Deus, o Pai, e Jesus Cristo. Uma das Personagens (o Pai) apontou para a outra (o Filho) e disse: "Este é Meu Filho Amado. Ouve-O!". Joseph perguntou qual igreja deveria se unir e foi instruído a não se unir a nenhuma delas, pois todas estavam em erro e suas crenças eram uma abominação. Ele foi informado de que a plenitude do evangelho lhe seria revelada em um momento posterior.

Joseph Smith escreveu vários relatos da visão entre 1832 e 1842, dois dos quais foram publicados em sua vida. A consistência desses relatos é um tema de debate, com variações que alguns consideram indicadores de mudanças significativas na teologia de Smith, enquanto outros as veem como ênfases diferentes em detalhes menores.

**Contexto Histórico Mundial:**
* 1820: Revolução Liberal do Porto em Portugal; Descoberta da Antártida por Fabian Gottlieb von Bellingshausen e Edward Bransfield; Publicação de "Ivanhoe" de Walter Scott.

**Pontos Positivos:**
* Para os Santos dos Últimos Dias, a Primeira Visão é a pedra angular da Restauração do evangelho de Jesus Cristo, confirmando a natureza corporal de Deus, o Pai, e Jesus Cristo, e a necessidade de uma restauração da Igreja.
* A experiência de Joseph Smith é vista como um testemunho pessoal e direto da existência de Deus e de Jesus Cristo, e da comunicação divina com a humanidade nos tempos modernos.
* A visão forneceu a Joseph Smith a direção para não se unir a nenhuma das igrejas existentes, preparando o caminho para a organização de uma nova igreja.

**Pontos Negativos/Controversos:**
* A existência de múltiplos relatos da Primeira Visão, com variações em detalhes como o número de Personagens vistas e o propósito da oração de Joseph, é frequentemente citada por críticos como evidência de que a história evoluiu ao longo do tempo e não foi um evento singular e consistente.
* A falta de menção da Primeira Visão em alguns dos primeiros escritos e sermões de Joseph Smith, e sua relativa obscuridade entre os primeiros membros da Igreja, é outro ponto de controvérsia. A visão só ganhou proeminência na teologia da Igreja de Jesus Cristo dos Santos dos Últimos Dias no início do século XX.
* Críticos argumentam que a visão pode ter sido influenciada pelo ambiente religioso da época (o Segundo Grande Despertar) e pelas crenças populares em visões e revelações.

**Fontes:**
* Wikipedia: [First Vision](https://en.wikipedia.org/wiki/First_Vision)
* The Joseph Smith Papers: [Accounts of the First Vision](https://www.josephsmithpapers.org/site/accounts-of-the-first-vision)
* The Church of Jesus Christ of Latter-day Saints: [First Vision](https://www.churchofjesuschrist.org/study/manual/gospel-topics/first-vision?lang=eng)
`;

    // --- FUNÇÕES DE FORMATAÇÃO ---

    function convertToLinks(text) {
        if (!text) return '';
        let processedText = text;
        const markdownRegex = /\[([^\]]+)\]\((https?:\/\/[^)]+)\)/g;
        processedText = processedText.replace(markdownRegex, '<a href="$2" target="_blank" rel="noopener noreferrer">$1</a>');
        const plainUrlRegex = /(?<!href=")(https?:\/\/[^\s<]+)/g;
        processedText = processedText.replace(plainUrlRegex, (url) => {
            return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
        });
        return processedText;
    }

    function formatWorldContext(context) {
        if (!context) return '';
        const lines = context.split('\n').filter(line => line.trim());
        return lines.map(line => {
            const cleanLine = line.trim().replace(/^\*\s*/, '');
            const match = cleanLine.match(/^(\d{4}:.*?)(?=\s*\([^)]*\)|,|$)/);
            if (match) {
                const boldPart = match[1].trim();
                const restOfPart = cleanLine.substring(match[0].length);
                return `<p><strong>${boldPart}</strong>${restOfPart}</p>`;
            }
            return `<p>${cleanLine}</p>`;
        }).join('');
    }

    // --- LÓGICA DE PARSING E RENDERIZAÇÃO ---

    function parseTimelineData(data) {
        const events = [];
        let currentPeriod = '', currentTitle = '', currentData = '', currentLocal = '', currentDetails = '', currentContext = '', currentPositive = '', currentNegative = '', currentSources = '';
        let inSection = null;

        const lines = data.split('\n');
        for (const line of lines) {
            if (line.startsWith('## Período:')) {
                if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
                currentPeriod = line.replace('## Período:', '').trim();
                currentTitle = ''; currentData = ''; currentLocal = ''; currentDetails = ''; currentContext = ''; currentPositive = ''; currentNegative = ''; currentSources = ''; inSection = null;
            } else if (line.startsWith('### Título:')) {
                if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
                currentTitle = line.replace('### Título:', '').trim();
                currentData = ''; currentLocal = ''; currentDetails = ''; currentContext = ''; currentPositive = ''; currentNegative = ''; currentSources = ''; inSection = null;
            } else if (line.startsWith('**Data:**')) { currentData = line.replace('**Data:**', '').trim(); inSection = null; }
            else if (line.startsWith('**Local:**')) { currentLocal = line.replace('**Local:**', '').trim(); inSection = null; }
            else if (line.startsWith('**Detalhes:**')) { currentDetails = line.replace('**Detalhes:**', '').trim(); inSection = 'details'; }
            else if (line.startsWith('**Contexto Histórico Mundial:**')) { currentContext = ''; inSection = 'context'; }
            else if (line.startsWith('**Pontos Positivos:**')) { currentPositive = ''; inSection = 'positive'; }
            else if (line.startsWith('**Pontos Negativos/Controversos:**')) { currentNegative = ''; inSection = 'negative'; }
            else if (line.startsWith('**Fontes:**')) { currentSources = ''; inSection = 'sources'; }
            else if (line.trim() !== '') {
                if (inSection === 'details') { currentDetails += '\n' + line; }
                else if (inSection === 'context') { currentContext += '\n' + line; }
                else if (inSection === 'positive') { currentPositive += '\n' + line; }
                else if (inSection === 'negative') { currentNegative += '\n' + line; }
                else if (inSection === 'sources') { currentSources += '\n' + line; }
            }
        }
        if (currentTitle) events.push({ period: currentPeriod, title: currentTitle, data: currentData, local: currentLocal, details: currentDetails, context: currentContext, positive: currentPositive, negative: currentNegative, sources: currentSources });
        return events;
    }

    function extractYearFromDate(dateString) {
        const yearMatch = dateString.match(/\b(1[0-9]{3}|20[0-9]{2})\b/);
        return yearMatch ? yearMatch[0] : '????';
    }

    const timelineEvents = parseTimelineData(timelineDataRaw);
    const timelineContainer = document.getElementById('timeline-container');
    let itemIndex = 0;

    timelineEvents.forEach(event => {
        const item = document.createElement('div');
        item.classList.add('timeline-item');

        const badge = document.createElement('div');
        badge.classList.add('timeline-badge');
        badge.innerHTML = extractYearFromDate(event.data);
        item.appendChild(badge);

        const panel = document.createElement('div');
        panel.classList.add('timeline-panel');

        const heading = document.createElement('div');
        heading.classList.add('timeline-heading');
        heading.innerHTML = `<h3>${event.title}</h3><span class="timeline-date">${event.data} - ${event.local}</span>`;
        
        if (event.context) {
            const worldContext = document.createElement('div');
            worldContext.classList.add('world-context');
            // Removi a tag <hr> daqui conforme solicitado anteriormente
            worldContext.innerHTML = `<h5>🌍 Contexto Histórico Mundial</h5><div>${formatWorldContext(event.context)}</div>`;
            heading.appendChild(worldContext);
        }
        
        panel.appendChild(heading);

        const body = document.createElement('div');
        body.classList.add('timeline-body');
        const summary = event.details.split('\n')[0] + '...';
        body.innerHTML = `<p>${convertToLinks(summary)}</p>`;
        panel.appendChild(body);

        const toggleButton = document.createElement('button');
        toggleButton.classList.add('toggle-details');
        toggleButton.textContent = 'Ver Detalhes';
        const detailsId = 'details-' + (itemIndex++);
        toggleButton.setAttribute('aria-expanded', 'false');
        toggleButton.setAttribute('aria-controls', detailsId);
        panel.appendChild(toggleButton);

        const fullDetails = document.createElement('div');
        fullDetails.classList.add('full-details');
        fullDetails.id = detailsId;
        
        // --- LÓGICA DE MONTAGEM CORRIGIDA ---
        // Agora cada seção é criada e adicionada na ordem correta.

        // 1. Seção de Detalhes
        const detailsDiv = document.createElement('div');
        detailsDiv.innerHTML = `<h4>Detalhes:</h4><p>${convertToLinks(event.details.replace(/\n/g, '<br>'))}</p>`;
        fullDetails.appendChild(detailsDiv);

        // 2. Seção de Pontos Positivos
        if (event.positive) {
            const positiveSection = document.createElement('div');
            positiveSection.classList.add('positive-section');
            let content = '<ul>';
            event.positive.split('\n').filter(l => l.trim()).forEach(line => {
                content += `<li>${convertToLinks(line.replace(/^\*\s*/, ''))}</li>`;
            });
            content += '</ul>';
            positiveSection.innerHTML = `<h4>✅ Pontos Positivos:</h4>${content}`;
            fullDetails.appendChild(positiveSection);
        }
        
        // 3. Seção de Pontos Negativos/Controversos
        if (event.negative) {
            const negativeSection = document.createElement('div');
            negativeSection.classList.add('negative-section');
            let content = '<ul>';
            event.negative.split('\n').filter(l => l.trim()).forEach(line => {
                let processedLine = convertToLinks(line.replace(/^\*\s*/, ''));
                content += `<li class="critical-text">${processedLine}</li>`;
            });
            content += '</ul>';
            negativeSection.innerHTML = `<h4>⚠️ Pontos Negativos/Controversos:</h4>${content}`;
            fullDetails.appendChild(negativeSection);
        }
        
        // 4. Seção de Fontes (Agora adicionada por último)
        if (event.sources) {
            const sourcesDiv = document.createElement('div');
            let sourcesContent = '<ul>';
            event.sources.split('\n').filter(l => l.trim()).forEach(line => {
                sourcesContent += `<li>${convertToLinks(line.replace(/^\*\s*/, ''))}</li>`;
            });
            sourcesContent += '</ul>';
            sourcesDiv.innerHTML = `<h4>📚 Fontes:</h4>${sourcesContent}`;
            fullDetails.appendChild(sourcesDiv);
        }
        
        panel.appendChild(fullDetails);

        toggleButton.addEventListener('click', () => {
            const isExpanded = fullDetails.style.display === 'block';
            fullDetails.style.display = isExpanded ? 'none' : 'block';
            toggleButton.setAttribute('aria-expanded', !isExpanded);
            toggleButton.textContent = isExpanded ? 'Ver Detalhes' : 'Ocultar Detalhes';
        });

        item.appendChild(panel);
        timelineContainer.appendChild(item);
    });